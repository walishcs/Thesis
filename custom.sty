\usepackage[linguistics]{forest}
\usepackage[utf8]{inputenc}
\usepackage{libertine}
\usepackage{libertinust1math}
\usepackage{unicode-math}
\usepackage{xeCJK}
\setCJKmainfont{AR PL UKai TW}
\setCJKmonofont{AR PL UKai TW}
\setCJKsansfont{Noto Serif CJK TC}
\usepackage{pdfpages}
\usepackage{pdflscape}
\usepackage{subfiles} % 引入子文件
\usepackage{hyperref}
\hypersetup{hidelinks}
%\hypersetup{breaklinks=true}

%%% Customization  %%%
\usepackage{acro}
\acsetup{make-links}
\usepackage{abbr} % 引入abbr.sty
\usepackage{longtable}
\usepackage{zhlipsum, lipsum}   % dummy text
\usepackage{graphicx}           % figures
\usepackage{float}
\usepackage{enumitem}
\usepackage{booktabs}           % tables
\usepackage{multirow}
\usepackage{array}
\usepackage{makecell}
\usepackage{arydshln}
\usepackage{gb4e} %Glossing 用
\noautomath %防止gb4e爆掉
\usepackage{etoolbox} %gb4e 第一行斜體
\pretocmd{\gll}{\def\eachwordone{\itshape}\def\eachwordtwo{\normalfont}}{}{}%gb4e 第一行斜體
\usepackage[normalem]{ulem}
\useunder{\uline}{\ul}{}
\usepackage{multicol}
\usepackage{caption} 
\captionsetup[table]{skip=10pt} %表格caption間距
\setlength{\intextsep}{30pt plus 2pt minus 2pt} % 文本中的浮動體上下間距
\setlength{\textfloatsep}{20pt plus 2pt minus 4pt} % 頁面頂部或底部浮動體與文本之間的間距
\usepackage{chngpage} % allows for temporary adjustment of side margins
%\usepackage{cite}               % bibliography
\usepackage{xcolor} 
\usepackage{filecontents} %加入參考文獻說明

% subsubsection 以下層級 %
\usepackage{titlesec}

%標題字型
\usepackage{fontspec}
\newfontface\chapterfont{ChiayiCity.ttf}

\titleformat{\chapter}[display]
{\chapterfont\bfseries\filcenter}
{\huge\chaptername~\thechapter} %
{6ex}
{\Huge\thispagestyle{empty}}

% \titleformat{\section}
%   {\chapterfont\large\bfseries} % 使用指定的章節標題字型
%   {\thesection.}{10pt}{\large}

\setcounter{secnumdepth}{3}
\setcounter{tocdepth}{2}
% subsubsection 以下層級 %


% % 以下是在圖表目錄加上前綴 %
\usepackage{tocloft} %TOC裡的Table Figure


\usepackage{float}
\usepackage{caption}

% 定義新的浮動環境 Map
\usepackage{newfloat}
\DeclareFloatingEnvironment[
    fileext=lom,
    listname={List of Maps},
    name=Map,
    placement=htbp,
    within=chapter
]{map}

% 使 Map 計數器隨章節重置
\usepackage{chngcntr}
\counterwithin{map}{chapter}

% 自定義 List of Maps 的項目格式
\newlistof{map}{lom}{List of Maps}


\renewcommand{\cfttoctitlefont}{\chapterfont\hspace*{\fill}\Huge\bfseries}
\renewcommand{\cftaftertoctitle}{\hspace*{\fill}}
\renewcommand{\cftlottitlefont}{\chapterfont\hspace*{\fill}\Huge\bfseries}
\renewcommand{\cftafterlottitle}{\hspace*{\fill}}
\renewcommand{\cftloftitlefont}{\chapterfont\hspace*{\fill}\Huge\bfseries}
\renewcommand{\cftafterloftitle}{\hspace*{\fill}}
\renewcommand{\cftlomtitlefont}{\chapterfont\hspace*{\fill}\Huge\bfseries}
\renewcommand{\cftafterlomtitle}{\hspace*{\fill}}

% 修改 List of Tables, Figures 的條目樣式

\renewcommand{\cfttabpresnum}{Table~} % List of FIgures set up <<<<<<<<
\setlength{\cfttabnumwidth}{5ex}
\setlength{\cfttabindent}{0ex}
\newlength{\tablen}% a pre tabure title length
\settowidth{\tablen}{\bfseries\cfttabpresnum} % the word Table~
\addtolength{\tablen}{\cfttabnumwidth}
\renewcommand{\cfttabnumwidth}{\tablen}

\renewcommand{\cftfigpresnum}{Figure~} % List of FIgures set up <<<<<<<<
\setlength{\cftfignumwidth}{5ex}
\setlength{\cftfigindent}{0ex}
\newlength{\figlen}% a pre figure title length
\settowidth{\figlen}{\bfseries\cftfigpresnum} % the word Figure~
\addtolength{\figlen}{\cftfignumwidth}
\renewcommand{\cftfignumwidth}{\figlen}

\renewcommand{\cftmappresnum}{Map~} % List of map set up <<<<<<<<<<<<<<<<
\setlength{\cftmapnumwidth}{5ex}
\setlength{\cftmapindent}{0ex}
\newlength{\maplen}% a pre photo  title length
\settowidth{\maplen}{\bfseries\cftmappresnum} % the word map~
\addtolength{\maplen}{\cftmapnumwidth}
\renewcommand{\cftmapnumwidth}{\maplen}


% 自訂指令 %
\newcommand{\shb}[1]{\textsuperscript{#1}}
\newcommand{\xb}[1]{\textsubscript{#1}}
\newcommand{\aikai}[1]{\textcolor{red}{\textbf{#1}}}
\newcommand{\cvc}{$\symbb{CVC}$\xspace}



% Bibliography

\usepackage[sorting=nyt, backend=biber, style=authoryear-comp, dashed=false, maxcitenames=2, maxbibnames=99]{biblatex}

%\defbibnote{bib-intro}{\textsf{\lipsum[1]}}

\setcounter{biburllcpenalty}{100}
\setcounter{biburlucpenalty}{200}
\setcounter{biburlnumpenalty}{100}


\addbibresource{ref.bib} %Import the bibliography file
\renewcommand*{\nameyeardelim}{\space}
\renewcommand*{\postnotedelim}{\addcolon\space}
\renewcommand*{\bibpagespunct}{\addcolon\space}
\DefineBibliographyStrings{english}{%
  page             = {},
  pages            = {},
} 
%\renewcommand*{\bibfont}{\footnotesize}

\newcommand{\sameyear}[1]{}

\usepackage{xpatch}
\AtEveryBibitem{\clearfield{month}}
\AtEveryCitekey{\clearfield{month}}
\xpatchbibmacro{date+extradate}{%
  \printtext[parens]%
}{%
  \setunit{\addperiod\space}%
  \printtext%
}{}{}

\NewBibliographyString{toappear}
\DefineBibliographyStrings{english}{%
  toappear = {to appear},
}

%Add comma between two authors in bibliography only
\AtBeginBibliography{\renewcommand*{\finalnamedelim}{
  \finalandcomma
  \addspace\bibstring{and}\space}  
 }

\DeclareFieldFormat[article,inproceedings,misc,inbook,incollection]{citetitle}{#1}
\DeclareFieldFormat[article,inproceedings,misc,inbook,incollection]{title}{#1}
\DeclareFieldFormat[thesis]{title}{\mkbibemph{#1}}
\DeclareFieldFormat[article,book,inproceedings,misc,inbook,incollection,thesis]{addendum}{#1\nopunct}
\DeclareFieldFormat[article,inproceedings,misc,inbook,incollection,thesis]{volume}{#1}
\renewbibmacro{in:}{}

\DefineBibliographyStrings{american}{phdthesis = {PhD dissertation}}
\urlstyle{same}


%%END Bibliography Setup%%

